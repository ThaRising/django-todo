{% extends "base.html" %}
{% load crispy_forms_filters %}
{% load crispy_forms_tags %}
{% block title %}{{ title|default:"Fuck you" }}{% endblock title %}
{% block content %}
    <style>
        body {
            margin: 1rem;
        }
    </style>
    <div class="todo-list space-y-8">
        {% for model in models %}
            {% include "todo/todo-component.html" with title=model.title desc=model.description createdAt=model.date_created id=model.id done=model.complete only %}
        {% endfor %}
    </div>
    <label x-data="">
        Create new Item:
        <input type="text"
               x-ref="createTodo"
               x-on:keydown.enter.debounce="createTodoItem($event.target)"
               class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500">
    </label>
    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function createTodoItem(v) {
            if (!v.value) {
                return
            }
            $.ajax({
                        headers: {
                            "X-CSRFToken": getCookie('csrftoken')
                        },
                        type: "POST",
                        url: "/todo-app/todo/",
                        data: JSON.stringify({
                            "title": v.value
                        }),
                        processData: false,
                        contentType: 'application/json',
                    }
            )
            v.value = ""
        }
    </script>
{% endblock content %}
